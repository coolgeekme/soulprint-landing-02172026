---
phase: 01-core-migration
plan: 05
type: execute
wave: 4
depends_on: ["01-04"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User can upload 300MB+ ChatGPT export and import completes successfully without OOM"
    - "User sees real-time progress updates (Downloading → Parsing → Generating)"
    - "RLM service uses constant memory regardless of export size"
    - "Database shows import_status: quick_ready after completion"
  artifacts: []
  key_links:
    - from: "Frontend progress bar"
      to: "Database progress_percent"
      via: "polling shows real values"
      pattern: "progress_percent.*20|50|100"
    - from: "RLM memory usage"
      to: "ijson streaming"
      via: "constant memory during parse"
      pattern: "memory usage stays flat"
---

<objective>
Verify end-to-end streaming import pipeline works for large exports with real-time progress.

Purpose: Confirm that Vercel→RLM migration eliminates OOM failures and provides user-visible progress feedback.
Output: Validated system ready for production use with 300MB+ exports.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-core-migration/01-RESEARCH.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete streaming import pipeline from Vercel thin proxy to RLM processing with:
- Database schema with progress_percent and import_stage columns
- RLM /import-full endpoint using ijson + httpx for streaming
- Python quick pass generation matching TypeScript behavior
- Vercel /api/import/trigger thin authentication proxy
- Frontend progress polling with real-time updates
  </what-built>
  <how-to-verify>
**Test 1: Small export (baseline)**

1. Visit https://www.soulprintengine.ai/import
2. Upload a small ChatGPT export (<10MB ZIP or JSON)
3. Observe:
   - Upload completes, "Processing started" message appears
   - Progress bar appears showing 0%
   - Progress updates: "Downloading export" → "Parsing conversations" → "Generating soulprint"
   - Progress reaches 100%
   - Redirects to /chat automatically
4. In /chat, verify:
   - AI name is set (not "Soul" or "Assistant")
   - Archetype is meaningful
   - Can send a message and get personalized response

**Test 2: Large export (300MB+ - OOM test)**

1. Find or create a large ChatGPT export (300MB+ uncompressed conversations.json)
2. Upload via /import page
3. Observe:
   - Chunked upload completes (may take 30-60s)
   - Progress polling starts immediately
   - Progress updates appear every 2-3 seconds
   - **CRITICAL:** Import completes without "Processing failed" or timeout errors
4. Check Render RLM logs:
   - No "Out of Memory" errors
   - Memory usage stays relatively flat during parsing
   - Quick pass generation completes

**Test 3: Progress granularity**

1. Upload medium export (50-100MB)
2. Watch progress updates in browser DevTools Network tab:
   - Should see progress_percent values: 0 → 20 → 50 → 100 (or near those)
   - Should see import_stage values change 3-4 times
3. Verify progress bar visually moves (not stuck at 0% then jumps to 100%)

**Test 4: Error handling**

1. Upload an invalid file (e.g., plain text file renamed to .json)
2. Observe:
   - Import starts processing
   - Eventually fails with specific error message
   - import_status becomes 'failed'
   - import_error column shows meaningful error (not "Something went wrong")

**Expected outcomes:**
- ✓ Small exports complete in 15-45 seconds
- ✓ Large exports (300MB+) complete without OOM failures
- ✓ Progress updates are visible and granular (not just 0% → 100%)
- ✓ Stage messages change throughout pipeline
- ✓ Errors show specific messages, not generic failures
- ✓ RLM memory usage stays constant (check Render metrics)
  </how-to-verify>
  <resume-signal>
Type "approved" if all tests pass, or describe any failures with:
- Test number that failed
- Specific error message or unexpected behavior
- Screenshots of progress bar or error state (if helpful)
  </resume-signal>
</task>

</tasks>

<verification>
Manual verification checkpoint - see task for detailed test plan.
</verification>

<success_criteria>
- User uploads 300MB+ export successfully (no OOM)
- Progress updates visible in frontend (0% → 20% → 50% → 100%)
- Stage messages change during pipeline ("Downloading" → "Parsing" → "Generating")
- RLM memory usage stays constant (ijson streaming working)
- Database shows correct import_status: 'quick_ready' on completion
- Errors show specific messages in import_error column
- Small exports complete in 15-45s
- Large exports complete in 1-5 minutes (depending on size)
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-migration/01-05-SUMMARY.md`
</output>
