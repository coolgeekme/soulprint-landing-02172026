<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoulPrint Architecture</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #fff;
            padding: 40px;
            line-height: 1.6;
        }
        h1 { color: #EA580C; margin-bottom: 10px; }
        h2 { color: #EA580C; margin: 40px 0 20px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        h3 { color: #888; margin: 20px 0 10px; }
        .subtitle { color: #666; margin-bottom: 40px; }
        .section { background: #111; border: 1px solid #222; border-radius: 12px; padding: 24px; margin: 20px 0; }
        .table-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .table-card { background: #1a1a1a; border: 1px solid #333; border-radius: 8px; padding: 16px; }
        .table-card h4 { color: #EA580C; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .table-card .count { background: #EA580C; color: #000; padding: 2px 8px; border-radius: 12px; font-size: 12px; }
        .columns { font-size: 13px; color: #888; }
        .columns li { padding: 4px 0; border-bottom: 1px solid #222; }
        .columns li:last-child { border: none; }
        .key { color: #4ade80; }
        .flow-diagram { background: #0d0d0d; border-radius: 8px; padding: 24px; font-family: monospace; font-size: 14px; overflow-x: auto; }
        .flow-step { display: flex; align-items: center; margin: 8px 0; }
        .flow-box { background: #1a1a1a; border: 1px solid #EA580C; padding: 8px 16px; border-radius: 6px; margin: 4px; }
        .flow-arrow { color: #EA580C; margin: 0 8px; }
        .cron-list { display: flex; gap: 20px; flex-wrap: wrap; }
        .cron-item { background: #1a1a1a; border: 1px solid #333; padding: 12px 20px; border-radius: 8px; }
        .cron-item .path { color: #EA580C; font-family: monospace; }
        .cron-item .schedule { color: #666; font-size: 13px; }
        .status-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-top: 20px; }
        .status-card { background: #1a1a1a; border-radius: 8px; padding: 16px; text-align: center; }
        .status-card .value { font-size: 32px; font-weight: bold; color: #4ade80; }
        .status-card .label { color: #888; font-size: 14px; }
        .warning { color: #fbbf24; }
    </style>
</head>
<body>
    <h1>üß† SoulPrint Architecture</h1>
    <p class="subtitle">Database Map & Operational Flow</p>

    <h2>üì¶ Database Tables</h2>
    <div class="table-grid">
        <div class="table-card">
            <h4>üë§ user_profiles</h4>
            <p style="color:#666; margin-bottom:12px;">Core user data & soulprint</p>
            <ul class="columns">
                <li><span class="key">user_id</span> (PK ‚Üí auth.users)</li>
                <li>ai_name</li>
                <li>soulprint (JSON)</li>
                <li>soulprint_text (SOUL.md)</li>
                <li>import_status / embedding_status</li>
                <li>embedding_progress %</li>
                <li>total_chunks / processed_chunks</li>
                <li>soulprint_locked / locked_at</li>
            </ul>
        </div>

        <div class="table-card">
            <h4>üí¨ conversation_chunks <span class="count">909</span></h4>
            <p style="color:#666; margin-bottom:12px;">Imported ChatGPT history</p>
            <ul class="columns">
                <li><span class="key">id</span> (PK)</li>
                <li><span class="key">user_id</span> (FK)</li>
                <li>conversation_id</li>
                <li>title</li>
                <li>content</li>
                <li>embedding vector(1536) üîç</li>
                <li>message_count</li>
                <li>is_recent</li>
            </ul>
        </div>

        <div class="table-card">
            <h4>üß† learned_facts <span class="count">2</span></h4>
            <p style="color:#666; margin-bottom:12px;">Evolving memory from chats</p>
            <ul class="columns">
                <li><span class="key">id</span> (PK)</li>
                <li><span class="key">user_id</span> (FK)</li>
                <li>fact</li>
                <li>category (preferences/beliefs/etc)</li>
                <li>embedding vector(1536) üîç</li>
                <li>confidence</li>
                <li>status (active/superseded)</li>
                <li>superseded_by</li>
            </ul>
        </div>

        <div class="table-card">
            <h4>üìù chat_messages <span class="count">211</span></h4>
            <p style="color:#666; margin-bottom:12px;">Live chat history</p>
            <ul class="columns">
                <li><span class="key">id</span> (PK)</li>
                <li><span class="key">user_id</span> (FK)</li>
                <li>role (user/assistant)</li>
                <li>content</li>
                <li>created_at</li>
            </ul>
        </div>
    </div>

    <h2>üîÑ Operational Flow</h2>
    
    <div class="section">
        <h3>Import Flow (One-Time)</h3>
        <div class="flow-diagram">
            <div class="flow-step">
                <span class="flow-box">User uploads ZIP</span>
                <span class="flow-arrow">‚Üí</span>
                <span class="flow-box">Browser parses</span>
                <span class="flow-arrow">‚Üí</span>
                <span class="flow-box">/api/import/save-soulprint</span>
                <span class="flow-arrow">‚Üí</span>
                <span class="flow-box">user_profiles</span>
            </div>
            <div class="flow-step">
                <span class="flow-box" style="margin-left: 200px;">‚Üì chunks batched</span>
                <span class="flow-arrow">‚Üí</span>
                <span class="flow-box">/api/import/save-chunks</span>
                <span class="flow-arrow">‚Üí</span>
                <span class="flow-box">conversation_chunks</span>
            </div>
        </div>
    </div>

    <div class="section">
        <h3>Embedding Flow (Cron - Every 5 min)</h3>
        <div class="flow-diagram">
            <div class="flow-step">
                <span class="flow-box">Cron trigger</span>
                <span class="flow-arrow">‚Üí</span>
                <span class="flow-box">/api/embeddings/process</span>
                <span class="flow-arrow">‚Üí</span>
                <span class="flow-box">OpenAI text-embedding-3-small</span>
                <span class="flow-arrow">‚Üí</span>
                <span class="flow-box">Update chunks with vectors</span>
            </div>
        </div>
    </div>

    <div class="section">
        <h3>Chat Flow (Real-Time)</h3>
        <div class="flow-diagram">
            <div class="flow-step">
                <span class="flow-box">User message</span>
                <span class="flow-arrow">‚Üí</span>
                <span class="flow-box">/api/chat</span>
                <span class="flow-arrow">‚Üí</span>
                <span class="flow-box">Vector search (memory)</span>
                <span class="flow-arrow">‚Üí</span>
                <span class="flow-box">Claude response</span>
            </div>
            <div class="flow-step">
                <span class="flow-box" style="margin-left: 350px;">‚Üì async</span>
                <span class="flow-arrow">‚Üí</span>
                <span class="flow-box">learnFromChat()</span>
                <span class="flow-arrow">‚Üí</span>
                <span class="flow-box">learned_facts</span>
            </div>
        </div>
    </div>

    <div class="section">
        <h3>Synthesis Flow (Cron - Every 6 hrs)</h3>
        <div class="flow-diagram">
            <div class="flow-step">
                <span class="flow-box">Cron trigger</span>
                <span class="flow-arrow">‚Üí</span>
                <span class="flow-box">/api/memory/synthesize</span>
                <span class="flow-arrow">‚Üí</span>
                <span class="flow-box">Merge learned_facts</span>
                <span class="flow-arrow">‚Üí</span>
                <span class="flow-box">Update soulprint_text</span>
            </div>
        </div>
    </div>

    <h2>‚è∞ Cron Jobs</h2>
    <div class="cron-list">
        <div class="cron-item">
            <div class="path">/api/embeddings/process</div>
            <div class="schedule">*/5 * * * * (every 5 minutes)</div>
        </div>
        <div class="cron-item">
            <div class="path">/api/memory/synthesize</div>
            <div class="schedule">0 */6 * * * (every 6 hours)</div>
        </div>
    </div>

    <h2>üîç Vector Search (RPCs)</h2>
    <div class="section">
        <ul class="columns" style="max-width: 500px;">
            <li><strong>match_conversation_chunks</strong>(query_embedding, user_id, limit, threshold)</li>
            <li><strong>match_learned_facts</strong>(query_embedding, user_id, limit, threshold)</li>
        </ul>
        <p style="color:#666; margin-top:12px;">Both use cosine similarity on vector(1536) columns</p>
    </div>

    <h2>üìä Current Status</h2>
    <div class="status-grid">
        <div class="status-card">
            <div class="value">909</div>
            <div class="label">Total Chunks</div>
        </div>
        <div class="status-card">
            <div class="value warning">~50%</div>
            <div class="label">Embedded</div>
        </div>
        <div class="status-card">
            <div class="value">2</div>
            <div class="label">Learned Facts</div>
        </div>
        <div class="status-card">
            <div class="value">211</div>
            <div class="label">Chat Messages</div>
        </div>
    </div>

    <p style="color:#666; margin-top:40px; font-size:13px;">
        Generated: Jan 29, 2026 ‚Ä¢ SoulPrint Engine v1.0
    </p>
</body>
</html>
